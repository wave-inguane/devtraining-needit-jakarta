<?xml version="1.0" encoding="UTF-8"?>
<record_update sys_domain="global" table="sys_script_client">
    <sys_script_client action="INSERT_OR_UPDATE">
        <active>false</active>
        <applies_extended>false</applies_extended>
        <condition/>
        <description/>
        <field>active</field>
        <global>true</global>
        <messages/>
        <name>UnitTESTbuffer</name>
        <order/>
        <script><![CDATA[function onLoad() {
   //Type appropriate comment here, and begin script below
// https://github.com/ServiceNow/devtraining-createnotes-jakarta.git
	myAlert();
	
}

function myAlert(){
  g_form.addInfoMessage('<div class="modal-dialog modal-lg">'+
  '<div class="modal-content">'+
  '<div class="modal-header">'+
  '<h4 class="modal-title">Source Code</h4>'+
  '</div>'+
  '<div class="modal-body">'+
  '<pre>' +'UserName : '+ "Solution Hub Lookup" +'</pre>'+
  '</div>'+
  '</div>'+
  '</div>');
}


// setting to active = false to simplify how the dependencies can work.

function onChange(control, oldValue, newValue, isLoading) {
   if (isLoading || newValue == '') {
      return;
   }

   // this script is primarily used to set the task dependancy variables choices based on the task count
	
	if (newValue == '1'){
		g_form.setVisible('wo_task_1_dependency', false);	
	}
	
	if (newValue == '2'){
		g_form.setVisible('wo_task_1_dependency', false);		
		removeOptions('wo_task_1_dependency');
		addOptions('wo_task_1_dependency', newValue);		
		removeOptions('wo_task_2_dependency');
		addOptions('wo_task_2_dependency', newValue);
		
	}
	
	if (newValue == '3'){
		g_form.setVisible('wo_task_1_dependency', false);
		removeOptions('wo_task_1_dependency');
		addOptions('wo_task_1_dependency', newValue);		
		removeOptions('wo_task_2_dependency');
		addOptions('wo_task_2_dependency', newValue);
		removeOptions('wo_task_3_dependency');
		addOptions('wo_task_3_dependency', newValue);
	}
	
	if (newValue == '4'){
		g_form.setVisible('wo_task_1_dependency', false);
		removeOptions('wo_task_1_dependency');
		addOptions('wo_task_1_dependency', newValue);		
		removeOptions('wo_task_2_dependency');
		addOptions('wo_task_2_dependency', newValue);
		removeOptions('wo_task_3_dependency');
		addOptions('wo_task_3_dependency', newValue);
		removeOptions('wo_task_4_dependency');
		addOptions('wo_task_4_dependency', newValue);
	}
	
	if (newValue == '5'){
		g_form.setVisible('wo_task_1_dependency', false);
		removeOptions('wo_task_1_dependency');
		addOptions('wo_task_1_dependency', newValue);		
		removeOptions('wo_task_2_dependency');
		addOptions('wo_task_2_dependency', newValue);
		removeOptions('wo_task_3_dependency');
		addOptions('wo_task_3_dependency', newValue);
		removeOptions('wo_task_4_dependency');
		addOptions('wo_task_4_dependency', newValue);
		removeOptions('wo_task_5_dependency');
		addOptions('wo_task_5_dependency', newValue);
	}

	
	function addOptions(dependency, count){
		var depend = dependency.charAt(8);
		var stop = count++;
		for (var i = 1; i <= stop; i++){
			var h = i + '';
			if (depend != h){
				var task = 'Task ' + i;
				g_form.addOption(dependency, i, task);
			}
		}
	}
		
	function removeOptions(dependency){
		g_form.removeOption(dependency, '1');
		g_form.removeOption(dependency, '2');
		g_form.removeOption(dependency, '3');
		g_form.removeOption(dependency, '4');
		g_form.removeOption(dependency, '5');
	}
	   
}

//DEFAULT
function highlights(tableName,fieldName){
	//Highlight affected fields
	g_form.flash(tableName+'.'+fieldName, "#00FF00", -4);
	(function () {
		var myVar2 = g_form.getControl(fieldName);
		myVar2.style.width = '200px';
		myVar2.style.backgroundColor = 'yellow';
		myVar2.style.color = 'mediumblue';
		//myVar2.style.fontWeight = 'bold';
		(function (node) {
			var level = 1;
			var step = function () {
				var hex = level.toString(16);
				node.style.backgroundColor = '#FFFF' + hex + hex;
				if (level < 15) {
					level += 1;
					setTimeout(step, 100);
				}
			};
			setTimeout(step, 100);
		}(myVar2));
	}());
}

//--------------------------------------------------------------------------
/*
Hi Ian,

I am working on USCIS-1573, and I just hit a roadblock. I would like to share my screen with you today to demo the story and get some feedback from you.

I have attached a file that contains the breakdown of the story in 4-parts.

I am currently working on part one.

Please ping me on skype when you are ready to help out.
*/
//--------------------------------------------------------------------------


//--------------------------------------------------------------------------
// isMember check for membership
//--------------------------------------------------------------------------
function onLoad() {
	g_form.setValue('requested_by',g_user.userID);
	
	
	//Check to see if logged in user is a member of selected group
	var grpName = 'Deployment Services';
	var usrID = g_user.userID; //Get current user ID
	var grp = new GlideRecord('sys_user_grmember');
	grp.addQuery('group.name', grpName);
	grp.addQuery('user.sys_id', usrID);
	grp.query();
	if (grp.next()){
		// user is a member of the group - allow the form to load normally.
	}
	else {
		// user it not a member of the so we need to warn them that it won't work properly
		alert('This service is for Deployment Services group members only.  If you see this message the system does not recognize you as are being a member.  This will result in an inappropriate Catalog Task assignment.');
		g_form.showErrorBox("requested_by", "Not recognized as a Deployment Services group member"); 
	}	
}


//--------------------------------------------------------------------------
// get focus
//--------------------------------------------------------------------------
function ritm2inc() {
	
	var current_sys_id = g_form.getUniqueValue();
	var current_work_notes = g_form.getValue('work_notes');
	
	if(current_work_notes.length < 14){
		alert('The following mandatory fields are not filled in: Work notes');
		
		var myVar2 = g_form.getControl('work_notes');
		myVar2.style.borderColor = 'red';
		
		g_form.showFieldMsg('work_notes', 'get_focus', 'error');//focus
		g_form.hideFieldMsg('work_notes');
		g_form.setMandatory("work_notes", true);
		g_form.flash('sc_req_item.work_notes', "#FFFACD", -4);
		
	}else{
		g_form.clearMessages();
		g_form.setMandatory("work_notes", false);
		var myVar = g_form.getControl('work_notes');
		myVar.style.borderColor = 'silver';
		try{
			//Initialize and open the dialog
			var incNumber = g_form.getValue("number");
			g_form.getReference('opened_by', function(obj){
				//var ritmOriginator = obj.last_name +", "+
				//obj.first_name +" "+
				//obj.middle_name+" ";
				var ritmOriginatorEmail = obj.email;
				
				var dialog = new GlideDialogWindow("SNOWTeamRITMtoINC"); //Instantiate the dialog containing the UI Page
				dialog.setTitle("Create EZ Ticket INC from " + incNumber); //Set the dialog title
				dialog.setPreference('sourceInc', incNumber); //Pass in source Incident Number
				dialog.setPreference('openedByEmail', ritmOriginatorEmail);
				dialog.setPreference('sys_id', g_form.getUniqueValue());
				
				dialog.render();
			});
		}catch(e){
			g_form.addErrorMessage('Error in Convert to EZ ticket UI Action : ' + e.message);
		}
	}
}


//--------------------------------------------------------------------------
// Table: sp_widget
//
//--------------------------------------------------------------------------
function onSubmit() {
	var value = g_form.getValue("template");
	if (value.length > 0 && value.indexOf('href="#"') > 0) {
		g_form.showFieldMsg("template", "Do not use href=\"#\" in the Service Portal, use href=\"javascript:void(0)\" instead", "error");
		return false;
	}
}


//--------------------------------------------------------------------------
// Table: sp_widget
//--------------------------------------------------------------------------
function onChange(control, oldValue, newValue, isLoading, isTemplate) {
	if (newValue == '')
		return;
	
	var s = newValue;
	var fixedValue = s.toLowerCase().replace(/[^a-zA-Z0-9]/g, "-");

	var gr = new GlideRecord("sp_widget");
	gr.addQuery("id", fixedValue);
	gr.addQuery("sys_id", "!=", g_form.getUniqueValue());
	gr.query(function() {
		if (gr.next())
			g_form.showFieldMsg("id", "Widget ID already exists, try a different value", "error");

		if (fixedValue == newValue)
			return;
	
		g_form.setValue("id", fixedValue);
	});
}


//----------------------------------------------------------------------------------------
// Table hub
//-----------------------------------------------------------------------------------------

/*
========================================================================================
Table Label: Tables table of all tables

Table Name: sys_db_object
https ... /nav_to.do?uri=%2Fsys_db_object_list.do
https ... / /
*/

/*
=========================================================================================
Usage : get field names = Column names
        Find out: Column lable and name
		use column name to extract the value
		Ex: gr.column_name or gr.column_name.ref_column_name
		
Table Label: Dictionary Entries 
Table Name: sys_dictionary.list
https ... /nav_to.do?uri=%2Fsys_dictionary_list.do
https ... /
*/

/*
=========================================================================================
Usager: group name lookup the group members and Roles

Table Label: Group  

Table Name: sys_user_group.list
https ... /nav_to.do?uri=%2Fsys_user_group_list.do
https ... /nav_to.do?uri=%2Fsys_db_object.do%3Fsys_id%3Dsys_user_group%26sysparm_refkey%3Dname
*/


/*
=========================================================================================
Table Label: 

Table Name: sys_user_grmember
https ... /nav_to.do?uri=%2Fsys_user_grmember_list.do
https ... /
*/
// GET members information
function isGroupMember(){
	var gr = new GlideRecord('sys_user_grmember');
	gr.addQuery('group.name','Change Management Team');
	gr.query();
	//gs.addErrorMessage("COUNT : " + gr.getRowCount());
	
	var count = 0;
	while(gr.next() && count  < 20){

		var userObj = gr.user; //get User ID
		//var userObj = gr.user.email; //get User ID
		//gs.addInfoMessage("User Email : " + userObj.email);
		// Fire the event
		//gs.eventQueue('snow_ritm_enhance_cancel_email', gr, openedByEmail, gr2.number);
	}
}


/*
===========================================================================================
Table Label: User

Table Name: sys_user
https ... /nav_to.do?uri=%2Fsys_db_object.do%3Fsys_id%3Dsys_user%26sysparm_refkey%3Dname
https ... /
*/


/*
===========================================================================================
Table Label: Requested Items

Table Name: sc_req_item
https ... /nav_to.do?uri=%2Fsc_req_item_list.do
https ... /
*/


/*
=========================================================================================
Table Label: Customer Updates

Table Name: sys_update_xml
https ... /nav_to.do?uri=%2Fsys_update_xml_list.do
https ... /
*/


/*
=======================================================================================
Table Label: Business Rules

Table Name: sys_script
https ... /nav_to.do?uri=%2Fsys_script_list.do
https ... /
*/


/*
======================================================================================
Table Label: Catalog Items

Table Name:sc_cat_item_list
https ... /sc_cat_item_list.do
https ... /
*/


/*
======================================================================================
Table Label: Catalog UI Policy

Table Name: catalog_ui_policy
https ... /nav_to.do?uri=%2Fcatalog_ui_policy_list.do
https ... /
*/


/*
======================================================================================
Table Label: Catalog Client Scripts

Table Name: catalog_script_clien
https ... /nav_to.do?uri=%2Fcatalog_script_client_list.do
https ... /
*/


/*
=====================================================================================
Table Label: Client Scripts

Table Name: sys_script_client
https ... /nav_to.do?uri=%2Fsys_script_client_list.do%3Fsysparm_referring_url%3Dincident_list.do
https ... /
*/


/*
========================================================================================
Table Label: Incidents

Table Name: inciden
https ... /nav_to.do?uri=%2Fincident_list.do%3Fsysparm_query%3D%26sysparm_first_row%3D1%26sysparm_view%3D
https ... /
*/


/*
=========================================================================================
Table Label: Users

Table Name: sys_user
https ... /nav_to.do?uri=%2Fsys_user_list.do
https ... /
*/


/*
=========================================================================================
Table Label: Question Choices

Table Name: question_choice
https ... /nav_to.do?uri=%2Fquestion_choice_list.do%3F
https ... /
*/


/*
========================================================================================
Table Label: Schedules Script Executions

Table Name: sysauto_script
https ... /nav_to.do?uri=%2Fsysauto_script_list.do
https ... /
*/


/*
========================================================================================
Table Label: Journal Entries

Table Name: sys_journal_field
https ... /nav_to.do?uri=%2Fsys_journal_field_list.do
https ... /
*/

/*
========================================================================================
Table Label: Attachments

Table Name: sys_attachment
https ... /nav_to.do?uri=%2Fsys_attachment_list.do
https ... /
*/

/*
========================================================================================
Table Label: Workflow Activities

Table Name: wf_activity
https ... /nav_to.do?uri=%2Fwf_activity_list.do
https ... /
*/

/*
========================================================================================
Table Label: Fix Script

Table Name: sys_script_fix
https ... /nav_to.do?uri=%2Fsys_script_fix.do
https ... /
*/


/*
========================================================================================
Table Label: Notifications

Table Name: sysevent_email_action
https ... /nav_to.do?uri=%2Fsysevent_email_action_list.do
https ... /
*/

/*
========================================================================================
Table Label: Service Portal Designer

Table Name:
https ... /$spd.do#/portal/select
https ... /
*/

/*
========================================================================================
Table Label: Emails

Table Name: sys_email
https ... /nav_to.do?uri=%2Fsys_email_list.do%3Fsysparm_userpref_module%3D8d620b63c611227b008368697b0b8d7b%26sysparm_query%3Dsys_created_onONToday@javascript:gs.daysAgoStart(0)@javascript:gs.daysAgoEnd(0)%5EEQ%26sysparm_clear_stack%3Dtrue%26sysparm_clear_stack%3Dtrue
https ... /
*/

/*
========================================================================================
Table Label: Update Sets

Table Name: sys_update_set
https ... /nav_to.do?uri=%2Fsys_update_set_list.do%3Fsysparm_userpref_module%3D50047c06c0a8016c0135a14cebc8191b%26sysparm_clear_stack%3Dtrue
https ... /
*/

/*
========================================================================================
Table Label: Creating Custom Widget Objectives Service Portal

Table Name:
https ... /app.do#!/training/article/app_store_learnv2_serviceportal_jakarta_creating_custom_widgets/app_store_learnv2_serviceportal_jakarta_creating_custom_widget_objectives?v=jakarta
https ... /
*/

/*
========================================================================================
Table Label: Service Portal Pages

Table Name: sp_page
https ... /nav_to.do?uri=%2Fsp_page_list.do%3Fsysparm_first_row%3D1%26sysparm_query%3DGOTOid%253E%253Dmy_hello_world_1%26sysparm_query_encoded%3DGOTOid%253E%253Dmy_hello_world_1%26sysparm_view%3D
https ... /
*/

/*
========================================================================================
Table Label: 

Table Name:
https ... /
https ... /
*/

/*
========================================================================================
Table Label: 

Table Name:
https ... /
https ... /
*/

/*
========================================================================================
Table Label: 

Table Name:
https ... /
https ... /
*/

/*
========================================================================================
Table Label: 

Table Name:
https ... /
https ... /
*/

/*
========================================================================================
Table Label: Log debugger

Table Name: syslog_list
https ... /https://dev25300.service-now.com/nav_to.do?uri=%2Fsyslog_list.do%3Fsysparm_query%3D%26sysparm_first_row%3D1%26sysparm_view%3D
https ... /
*/

/*
========================================================================================
Table Label: Debug Portal

Table Name:
https ... /app.do#!/training/article/app_store_learnv2_serviceportal_jakarta_creating_custom_widgets/app_store_learnv2_serviceportal_jakarta_debugging_widgets?v=jakarta
https ... /app.do#!/training/article/app_store_learnv2_serviceportal_jakarta_creating_custom_widgets/app_store_learnv2_serviceportal_jakarta_creating_custom_widget_objectives?v=jakarta

Creating Custom Widget Objectives
In this module you will learn to:

Clone baseline widgets
Write widget logic
HTML Template
Client Script
Server Script
Test Widgets
Preview
Test Page
JavaScript Console
Use the Widget APIs
Use the widget global objects
data
input
options
Create and use directives
Define and use widget options
Respond to record changes which occur outside of Service Portal
*/


//--------------------------------------------------------------------------
// style="background-color: #3b0160;"
/*
<div class="activity_field" name="close_notes" style="background-color: purple; color: white; display: block;" label="Close notes"><span class="activity_label">Close notes:</span>&nbsp;<span>Test</span></div>
*/
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//--------------------------------------------------------------------------
// http://www.tutorialspoint.com/bootstrap/bootstrap_responsive_utilities.htm
//--------------------------------------------------------------------------

//DEFAULT
//DEFAULT
//How to create new controller in Client script · Issue #205 · service-portal/documentation · GitHub


//--------------------------------------------------------------------------
/*
Hi Prashanthi,

I was able to get the workflow to auto-generate the tasks in chronological order. However, this change introduced a delay of 5 to 7 seconds for the form to display all tasks in such order.

Is it imperative that the tasks are generated in chronological order?
*/
//--------------------------------------------------------------------------


//==================================================================================================
/*
Got to thinking about this and wanted to touch base to get some input from you. 

What happens when a Change Request (and corresponding task) are created with only 4 days until the planned end date?  SLA timers are fixed, in this case it will always be 9 calendar days (I think you wanted this down to 7, but either way it is fixed once we set it) so if the SLA starts with 4 days until the Planned End Date, the SLA timer will allow 9 days until it runs out of time and SLA is missed.

I have a couple potential ways to dynamically adjust this as we go but I am not really sure if it will work and it certainly will make reporting a challenge.  

With that in mind, do we just want to allow a straight 7 days regardless of how soon the planned end date is?  I can still use the nightly scheduled job to check for any Change Tasks that recently passed into the 7 day timer, but it won't be as graceful holding shorting timers to the exact planned end date.  

Not sure what percentage of these changes would even be setup closer than 7 days to the planned end date so I might be making this a bigger deal than it is but I wanted to consider it before we proceed much further as it significantly impacts the direction I take with how this will work.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


*/

]]></script>
        <sys_class_name>sys_script_client</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2017-10-16 04:59:17</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>674aac9a4f7983003b564ea18110c7f4</sys_id>
        <sys_mod_count>84</sys_mod_count>
        <sys_name>UnitTESTbuffer</sys_name>
        <sys_overrides/>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_script_client_674aac9a4f7983003b564ea18110c7f4</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2017-12-18 23:27:53</sys_updated_on>
        <table>x_58872_needit_needit</table>
        <type>onLoad</type>
        <ui_type>0</ui_type>
        <view/>
    </sys_script_client>
</record_update>
