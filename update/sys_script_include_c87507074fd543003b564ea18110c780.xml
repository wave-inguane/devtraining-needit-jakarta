<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_58872_needit.PutAjaxUtils</api_name>
        <client_callable>true</client_callable>
        <description/>
        <name>PutAjaxUtils</name>
        <script><![CDATA[var PutAjaxUtils = Class.create();
PutAjaxUtils.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
	
	/******************************************************************************
 	* Method 1
 	*******************************************************************************/
	helloWorld: function() {
		
		var semaphore = {x:1};
			
			this._P(semaphore);//AquireLock
			//**************************************************
			//DO WORK
			var gdt = new GlideDateTime();
			var ClassName = this.getParameter('sysparm_ClassName');
			var FunctionName = this.getParameter('sysparm_FunctionName');
			gs.addInfoMessage("$SERVER$: Script Include { GetAjaxUtils } Invoked By: " + ClassName +" "+ FunctionName +" @  " + gdt );
				
				var tableName = this.getParameter('sysparm_table_name');
				var gr = new GlideRecord(tableName); //Indicate the table to query from
				//The 'addQuery' line allows you to restrict the query to the field/value pairs specified (optional)
				gr.query();//needed to get the row count
				gs.addInfoMessage("$SERVER$: aquireLock : " + semaphore.x  + " TOTAL RECORDS : " + gr.getRowCount());
				
				
				// build new response xml element for result
				var result = this.newItem("result");//ElementTagName
				result.setAttribute("message", "$SERVER$ : Table queried { " + tableName + " } ");
					
					//---------- TDD----------------------------
					//-------------------------------------------------------
					//READ = GET
					// Always run GET before any CRUD operation is applied to data
					// Find all incidents with a priority of 1 or 2
					//-------------------------------------------------------
					var strQuery = this.getParameter('sysparm_strQuery');//from client
					gr.addEncodedQuery(strQuery);
					gr.query();
					//-----------------END CRUD --------------------
					//---------------------TDD----------------------
					
					//var Number = this.getParameter('sysparm_record_number');
					//var fieldName = this.getParameter('sysparm_filed_name');
					while (gr.next()) { //While the recordset contains records, iterate through them
						//TODO:  must get gr.getValue('number'), gr.getDisplayValue('caller_id')
						// from the client
						this._addFavorite(gr.getValue('number'), gr.getDisplayValue('caller_id'));
						
						// all items are returned to the client through the inherited methods of
						//AbstractAjaxProcessor
					}
					//WORK DONE
					this._V(semaphore);//releaseLock
					gs.addErrorMessage("$SERVER$: releaseLock : " + semaphore.x + " TOTAL RECORDS : " + gr.getRowCount());
					
				},
				// this function is not client callable
				_addFavorite : function(name, value) {
					var favs = this.newItem("favorite");//ElementTagName
					favs.setAttribute("name", name);
					favs.setAttribute("value", value);
				},
				_P : function (sem){
					while(sem.x <= 0);
						sem.x--;
				},
				
				_V : function(sem){
					sem.x++;
				},
				_readAllFieldsSysNames : function(tableName){
					//use this method in the Business Rule
					var newForm = new GlideRecord(tableName);
					//var currentFields = [];
					newForm.initialize();
					for (var f in newForm){
						//currentFields.push(f);
						gs.addInfoMessage(f);
					}
				},
				type: 'PutAjaxUtils'
			});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2017-09-24 03:37:22</sys_created_on>
        <sys_id>c87507074fd543003b564ea18110c780</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>PutAjaxUtils</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_script_include_c87507074fd543003b564ea18110c780</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2017-09-24 03:37:22</sys_updated_on>
    </sys_script_include>
</record_update>
